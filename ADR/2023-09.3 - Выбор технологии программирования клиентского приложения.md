

 **ADR: 2023-09.3 -Выбор технологии программирования клиентского приложения**

**Дата:** 20 сентября 2023 г.

**Статус:** Принято

**Контекст:**  
Система спроектирована как набор микросервисов (см. ADR 2023-09.1). Для клиентской части нужно выбрать технологию, которая обеспечит лучший UX, быструю разработку и поддержку веб, Android и iOS‑платформ. Важны безопасность (авторизация через identity provider), интеграция с API серверной части (C# / .NET, ADR 2023-09.2) и возможность переиспользования кода между платформами.

**Рассмотренные варианты (web‑фреймворки):**  
1. **React:** Популярная и быстро развивающаяся JavaScript‑библиотека для создания пользовательских интерфейсов.  
2. **Vue.js:** Прогрессивный JavaScript‑фреймворк с лёгким входом и гибкостью.  
3. **Angular:** Полноценный фреймворк с широкими возможностями, но с более крутым порогом входа.  
4. **Svelte:** Новый и набирающий популярность фреймворк, отличающийся высокой производительностью и маленьким бандлом.

**Рассмотренные варианты для мобильной поддержки (кроссплатформенные подходы):**  
A. **React Native (общий код с React/Web):** максимальное переиспользование логики и типов (TypeScript).  
B. **Capacitor / Ionic:** web‑технологии внутри нативного контейнера (проще портировать web‑приложение).  
C. **Flutter:** единый каркас для web + mobile; требует отдельного стека от web‑React.  
D. **Нативная разработка (Kotlin/Swift):** полный контроль и лучший UX, но большая стоимость разработки и поддержки.

**Решение:**  
React + React Native

**Использовать React для веб‑клиента и React Native для мобильных приложений (Android/iOS).** Организовать монорепозиторий и общую библиотеку UI/логики (по возможности) для максимального переиспользывания.

**Обоснование:**  
- **Экосистема:** React + React Native имеют большое сообщество и зрелые библиотеки.  
- **Переиспользование:** бизнес‑логика, типы (TypeScript) и компоненты можно вынести в общие пакеты.  
- **Скорость разработки:** Expo (RN), CRA/Vite/Next.js ускоряют цикл разработки.  
- **Соответствие архитектуре:** хорошо сочетается с микросервисной бэкенд‑моделью и token‑based auth (OAuth2/OIDC).

**Преимущества выбора React + React Native:**  
- TypeScript и общие типы снижают ошибки интеграции.  
- Storybook + монорепозиторий для единой разработки UI.  
- Expo ускоряет прототипирование и CI/E2E.  
- Возможность PWA (React) для offline/installation.

**Недостатки и риски:**  
- Требуется адаптация UI/UX под платформы — нужен дизайн‑комплект.  
- RN может потребовать нативной разработки для специфичных API (например, медицинское оборудование).  
- Необходимость поддерживать monorepo/CI для нескольких платформ.  
- Надо обеспечить безопасное хранение токенов/секретов на мобильных устройствах.

**Безопасность и интеграция с сервером:**  
- **Auth:** OAuth2/OIDC (PKCE) для мобильных; краткоживущие access tokens, secure refresh storage (Keychain/Keystore / SecureStore).  
- **Транспорт:** HTTPS + certificate pinning (по риску); на сервере — mTLS внутрикластерно.  
- **Хранение секретов:** secure storage на мобильных (react‑native‑keychain, Expo SecureStore).  
- **API:** документировать через OpenAPI/GraphQL schema; генерировать clients/types.  
- **Наблюдаемость:** Sentry/Rollbar + OpenTelemetry (web) для трассировки.

**Инструменты и библиотеки (рекомендуемые):**  
- Язык: **TypeScript** (web + RN)  
- Web: **React**, Next.js или Vite + React Router  
- Mobile: **React Native** (+ Expo для старта) или bare RN при необходимости нативных модулей  
- State/Data: React Query / TanStack Query, Zustand / Redux  
- Network: fetch / Axios; GraphQL: Apollo  
- UI: Shared component library, Storybook; Material/AntD для web, адаптированные RN‑компоненты для mobile  
- Auth: oidc-client / react‑oauth2‑pkce / AppAuth  
- Secure storage: react‑native‑keychain, Expo SecureStore  
- Testing: Jest, React Testing Library; Detox / Appium для E2E mobile  
- CI/CD: GitHub Actions / Azure DevOps; Mobile: EAS (Expo) / Fastlane  
- Monitoring: Sentry, analytics (опционально)

**Архитектурные рекомендации:**  
- Монорепозиторий: pnpm / yarn workspaces / Nx / Turborepo.  
- Shared contracts: хранить OpenAPI/GraphQL schema и генерировать clients/types.  
- UI/Design system: единая дизайн‑система + Storybook.  
- API: REST+OpenAPI для простоты; GraphQL при сложных запросах.  
- Offline/Sync: локальное хранение + sync (SQLite/Realm) при необходимости.  
- Accessibility: соблюдать A11y и регуляторные требования медицины.
