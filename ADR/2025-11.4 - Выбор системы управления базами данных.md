**ADR: 2025-11.4 - Выбор системы управления базами данных**

**Дата:** 8 ноября 2025 г.

**Статус:** Принято

**Контекст:**  
Требуется выбрать реляционную систему управления базами данных для хранения основных данных медицинской системы записи: пользователи, записи на приём, расписания, профили пациентов и врачей. Необходимо обеспечить ACID-транзакции, целостность данных, высокую производительность, масштабируемость и соответствие требованиям безопасности для медицинских данных (152-ФЗ).

**Рассмотренные варианты:**  
1. **PostgreSQL** — открытая реляционная СУБД с расширенными возможностями, поддержкой JSON, полнотекстового поиска, репликации.  
2. **MySQL/MariaDB** — популярная открытая СУБД с высокой производительностью для чтения, широкой поддержкой в экосистеме.  
3. **Microsoft SQL Server** — коммерческая СУБД с глубокой интеграцией с .NET экосистемой, расширенными возможностями аналитики.  
4. **Oracle Database** — коммерческая enterprise-СУБД с высокой производительностью и расширенными функциями безопасности.  
5. **Yandex Database (YDB)** — распределённая NoSQL/NewSQL СУБД от Яндекс.Облака с автоматическим масштабированием.

**Решение:**  
Выбран **PostgreSQL**.

**Обоснование:**  
- Открытая лицензия (PostgreSQL License) — отсутствие лицензионных ограничений и затрат.  
- Высокая надёжность и соответствие стандартам ACID — критично для медицинских данных.  
- Богатый набор типов данных: JSON/JSONB для гибкого хранения, массивы, полнотекстовый поиск.  
- Отличная интеграция с .NET через Npgsql и Entity Framework Core.  
- Поддержка репликации (streaming replication, logical replication) для высокой доступности и масштабирования чтения.  
- Расширяемость через расширения (extensions): PostGIS, pg_trgm, pg_stat_statements и др.  
- Сильная поддержка транзакций и конкурентного доступа (MVCC).  
- Активное сообщество и регулярные обновления безопасности.  
- Возможность размещения в российских дата-центрах (Yandex Cloud, VK Cloud и др.).  
- Соответствие требованиям безопасности: поддержка шифрования на уровне соединения (SSL/TLS), ролевая модель доступа, аудит.

**Недостатки решения:**  
- Требует больше оперативной памяти по сравнению с MySQL для некоторых сценариев.  
- Меньше готовых решений для автоматического масштабирования по сравнению с облачными managed-сервисами.  
- Необходимость настройки и тюнинга для оптимальной производительности в production.  
- Ограниченная поддержка горизонтального масштабирования записи (требует шардинга или внешних решений).

**Последствия:**  
- Необходимость настройки репликации и резервного копирования для обеспечения высокой доступности.  
- Требуется мониторинг производительности и настройка индексов для оптимизации запросов.  
- Возможна необходимость использования connection pooling (PgBouncer) для управления соединениями в микросервисной архитектуре.  
- Необходимость планирования стратегии миграций схемы БД при развитии системы.  
- Требуется обеспечение соответствия требованиям 152-ФЗ по защите персональных данных пациентов.

