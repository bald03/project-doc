**ADR 2025-11.9 — Выбор библиотек для форм и валидации (React)**

**Дата:** 8 ноября 2025 г.  
**Статус:** Принято

**Контекст:**  
Проект использует React (web) и React Native (ADR 2025-11.3). Требуется стандартный стек для построения форм и валидации с хорошей поддержкой TypeScript, малым размером бандла, высокой производительностью и возможностью переиспользования схем/валидации между фронтом и бэком.

**Критерии оценки:**  
- Поддержка TypeScript и вывод типов из схем.  
- Производительность (реактивность, минимальные ререндеры).  
- Интеграция с React и React Native.  
- Размер бандла и простота использования.  
- Возможность схемной валидации и reuse логики/схем.  
- Поддержка серверной и клиентской валидации (runtime).

**Рассмотренные варианты (форм‑библиотеки):**  
1. **react-hook-form:** минимальные rerenders, работает с uncontrolled inputs, хорошая производительность и малый размер.  
2. **Formik:** зрелая, простая в использовании, но более дорогая по ререндер‑паттернам и бандлу.  
3. **React Final Form:** стабильная альтернативa, хороший контроль над state, но меньше recent community momentum.  
4. **Пользовательские/микро‑решения:** лёгкие реализации для простых форм, но не масштабируются для сложных сценариев.

**Рассмотренные варианты (валидационные библиотеки):**  
A. **Zod:** современная схема‑ориентированная библиотека с отличной поддержкой TypeScript (инференция типов), быстрый runtime.  
B. **Yup:** популярна, схожая по идее с Zod, но менее точная TypeScript‑инференция.  
C. **io‑ts:** строгая, функциональная валидация с runtime+compile‑time, но более сложна в использовании.  
D. **Joi / Superstruct:** зрелые решения, но либо тяжелее, либо хуже интегрируются с TypeScript‑инференцией в сравнении с Zod.

**Решение:**  
Выбраны: **react-hook-form** для управления формами и **Zod** для схемной валидации. 

**Обоснование:**  
- **react-hook-form** даёт высокую производительность (меньше ререндеров), простую интеграцию с uncontrolled inputs и лёгкую интеграцию с React Native (Controller/ControllerAdapter), что важно для мобильной части.  
- **Zod** обеспечивает удобную схему‑ориентированную валидацию с отличной TypeScript‑инференцией — схемы можно использовать как для валидации в UI, так и на сервере (повторное использование логики).  
- Малый суммарный размер бандла и хорошая developer experience ускоряют разработку и поддержку.

**Недостатки / риски:**  
- Порог привыкания к паттерну react‑hook‑form (uncontrolled + Controller для сторонних компонентов).  
- Сложные динамические формы могут требовать шаблонных адаптеров/утилит.  
- Zod имеет API, отличное от некоторых старых проектов (Yup/Joi), потребуется миграция/обучение.

**Митигирующие меры:**  
- Создать shared UI‑формы и обёртки (Input, Select, DatePicker) с готовыми Controller‑адаптерами.  
- Подготовить шаблон формы и примеры использования (в monorepo общего пакета).  
- Документировать паттерны для динамических форм и лучших практик (field arrays, conditional fields).  
- Провести обучение/код‑ревью по использованию react‑hook‑form + zod.

**Шаги внедрения:**  
1. Зафиксировать версии: react‑hook‑form, zod, @hookform/resolvers.  
2. Создать shared package в монорепозитории с обёртками компонентов и утилитами (useFormFactory, common schemas, types).  
3. Подготовить шаблон формы + Storybook‑стори для формовых компонентов.  
4. Интегрировать примерную форму с OpenAPI/TypeScript codegen (если применяется) и продемонстрировать reuse схем.  
5. Обучить команды и покрыть ключевые формы тестами (unit + integration).

**Последствия:**  
- Единая стратегия валидации и форм, улучшенная типовая безопасность и меньше дублирования схем.  
- Потребуется рефакторинг существующих форм при миграции с других библиотек.  
- Улучшение качества данных за счёт повторного использования схем на сервере и клиенте.

**Альтернативы и почему не выбраны:**  
- **Formik + Yup:** проще для быстрых простых форм, но хуже по производительности и TypeScript‑инференции; затратнее при масштабировании.  
- **React Final Form:** стабильный выбор, но community/eco меньше для RN + TypeScript inference валидаций уступает связке react‑hook‑form+Zod.  

