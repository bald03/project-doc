**ADR 2023-09.4 — Выбор системы хранения файлов**

**Дата:** 20 сентября 2023 г.
**Статус:** Принято

**Контекст:**  
Для хранения файлов в нашем проекте (медицинские документы, изображения, вложения) нужно надёжное, масштабируемое и безопасное облачное хранилище. По требованиям регулятора, все данные должны храниться на территории РФ. Решение должно обеспечивать высокую доступность, версионирование и контроль доступа.

**Рассмотренные варианты:**
1. **VK Cloud S3:** S3-совместимое хранилище от VK Cloud Solutions с серверами в РФ.
2. **Selectel Storage:** Объектное хранилище от Selectel с дата-центрами в России.
4. **Yandex Object Storage:** S3-совместимое хранилище от Яндекс.Облака.

**Решение:**  
Выбран Yandex Object Storage.

**Обоснование:**
- **Локализация:** Все данные хранятся в ЦОДах на территории РФ, что соответствует требованиям регулятора.
- **Надёжность:** 99.999999999% durability, 99.99% availability, автоматическая репликация.
- **S3-совместимость:** Поддержка стандартного S3 API позволяет использовать существующие библиотеки и инструменты.
- **Безопасность:** 
  - Шифрование на стороне сервера
  - Интеграция с KMS Яндекс.Облака
- **Функциональность:**
  - Версионирование объектов
  - Уведомления об изменениях
  - CDN для раздачи контента
- **Экосистема:** Хорошая интеграция с другими сервисами Яндекс.Облака.

**Недостатки:**
- Привязка к инфраструктуре Яндекс.Облака
- Меньше глобальных точек присутствия по сравнению с международными провайдерами
- Ограниченный набор дополнительных сервисов по сравнению с AWS/Azure

**Последствия:**
- Файлы проекта хранятся в Yandex Object Storage с соответствующей структурой бакетов
- Необходимо внедрить:
  - Структуру бакетов и правила именования
  - IAM-роли и политики доступа
  - Lifecycle management для оптимизации хранения
  - Мониторинг использования и затрат
  - Резервное копирование критичных данных

**Связанные ADR:**
- ADR 2023-09.1 — Выбор архитектурной формы системы (микросервисы)
