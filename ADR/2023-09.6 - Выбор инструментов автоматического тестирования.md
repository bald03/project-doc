**ADR 2023-09.6 — Выбор инструментов автоматического тестирования**

**Дата:** 20 сентября 2023 г.  
**Статус:** Принято

**Контекст**  
Система микросервисная (ADR 2023-09.1). Серверная часть — C# / .NET (ADR 2023-09.2). Клиент — React + React Native (ADR 2023-09.3). Нужна унифицированная стратегия автоматического тестирования с интеграцией в CI/CD.

**Критерии оценки**  
- Поддержка стеков (.NET, React, React Native)  
- Лёгкость интеграции в CI/CD и контейнеры  
- Стабильность и параллелизм прогонов  
- Поддержка contract testing и reproducible infra для тестов  
- Наличие отчетности (coverage, тест‑результаты)

**Рассмотренные варианты (компоненты решения)**  
1. Unit: xUnit / NUnit (backend), Jest (frontend)  
2. Component/UI: Storybook + Testing Library  
3. Integration: Testcontainers / WebApplicationFactory (.NET), MSW / docker‑compose (JS)   
4. Security: OWASP ZAP + dependency scanners (Snyk/Dependabot)  

**Решение**  
Принят набор инструментов:  
- **Backend unit:** xUnit + FluentAssertions + Moq  
- **Frontend unit/component:** Jest + React Testing Library + Storybook  
- **Integration:** Testcontainers for .NET + WebApplicationFactory; MSW / docker‑compose для фронта  
- **Security:** OWASP ZAP + Dependabot  

**Обоснование выбора (кратко)**  
- Инструменты зрелые и поддерживают выбранные стеки.  
- Pact уменьшает риск регрессий интеграции без поднятия всех сервисов.  
- Playwright и Detox дают стабильные параллельные прогоны для web и RN.  
- Testcontainers обеспечивает воспроизводимую инфраструктуру в CI.  
- k6 и ZAP легко интегрируются в pipeline для регулярных прогонов.

**Рекомендации по использованию и политики**  
- **Пирамида тестирования:** unit → component → integration/contract → E2E → load/security.  
- **PR:** запускать unit + component (fast). Integration/contract — pre‑merge или gated pipeline. E2E/load/security — nightly / pre‑release.  
- Генерировать и публиковать pact‑контракты в артефакты; обязать продюсеров выполнять проверку контрактов.  
- Стандартизировать шаблоны тестовых проектов, версии инструментов и CI‑workflow.

**Шаги внедрения (порядок действий)**  
1. Закрепить версии инструментов и опубликовать «стандарт тестирования».  
2. Создать шаблон .NET‑сервиса с xUnit/Testcontainers и шаблон фронта с Jest/Storybook.  
3. Настроить shared CI‑workflows (unit, integration/contract, e2e, load, security).  
4. Включить сканирование зависимостей и nightly ZAP/k6 прогоны.  
5. Обучить команды и провести пилот на одном backend и одном frontend модуле.

**Риски и меры смягчения**  
- Рост времени pipeline — решать параллелизмом, fast smoke набором для PR и full прогоном в nightly.  
- Флейки — мониторить, фиксировать, отстранять вместо бессмысленных retries.  
- Стоимость инфраструктуры — использовать кеширование, ephemeral environments по запросу, оптимизировать матрицы запуска.

**Последствия**  
- Требуется инвестиция в CI/SRE поддержку и обучение команды.  
- Улучшение качества и снижение регрессий при росте покрытия контрактных и интеграционных тестов.  
- Нужна дисциплина в поддержке контрактов и шаблонов.

**Связанные ADR**  
- ADR 2023-09.1 — Архитектурная форма (микросервисы)  
- ADR 2023-09.2 — Технология серверной части (C# / .NET)  
- ADR 2023-09.3 — Технология клиентского приложения (React / React Native)
